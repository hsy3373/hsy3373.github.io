---
title: "[Oracle] SQL문법 3.집합 연산자와 JOIN"
excerpt: "UNION, JOIN 등 SQL 기본 문법"

categories:
  - Oracle
tags:
  - [Oracle, SQL]

comments: true
toc: true
toc_sticky: true

date: 2020-12-19
last_modified_at: 2020-12-19
---

## 집합 연산자(SET OPERATOR)

> ### 집합 연산자란

- 여러개의 쿼리문을(=SELECT 결과물) 가지고 하나의 쿼리문으로 만드는 연산자이다
- 여러개의 SELECT문을 하나로 연결한다
- 집합 연산자로 결합된 컬럼의 결과 컬럼 또한 데이터타입이 동일해야 한다
- 양 쿼리문의 결과를 합쳐서 한개의 테이블로 보여줘야 하기 때문에 각 쿼리문의 SELECT절 부분이 같아야 한다  
  => 조회할 <u>컬럼이 동일</u>해야 한다

<br>

#### [ UNION ]

```sql
SELECT EMP_ID, EMP_NAME, DEPT_CODE, SALARY
FROM EMPLOYEE
WHERE DEPT_CODE = 'D5' -- 6명 조회됨
UNION
SELECT EMP_ID, EMP_NAME, DEPT_CODE, SALARY
FROM EMPLOYEE
WHERE SALARY > 3000000; -- 8명 조회됨
-- 하지만 중복값이 제거되어 총 14명이 아닌, 6명이 출력된다
```

- 합집합
- 여러개의 쿼리 결과를 합치는 연산자로 중복된 영역은 제외한다  
  => 두 쿼리문의 수행 결과를 합친 후 중복값을 한번 제거한다
- 자주 사용하는 것을 권장하지 않는다

<br>

#### [ UNION ALL ]

```sql
SELECT EMP_ID, EMP_NAME, DEPT_CODE, SALARY
FROM EMPLOYEE
WHERE DEPT_CODE = 'D5' -- 6명 조회됨
UNION ALL
SELECT EMP_ID, EMP_NAME, DEPT_CODE, SALARY
FROM EMPLOYEE
WHERE SALARY > 3000000; -- 8명 조회됨
-- 중복값을 제외하지 않아, 둘을 더한 값인 총 14명이 출력된다
```

- 합집합 + 교집합
- 여러 쿼리 결과를 합치는 연산자로 중복된 영역 모두 포함하여 합친다  
  => 중복 제거를 하지 않는다

<br>

#### [ INTERSECT ]

```sql
SELECT EMP_ID, EMP_NAME, DEPT_CODE, SALARY
FROM EMPLOYEE
WHERE DEPT_CODE = 'D5' -- 6명 조회됨
INTERSECT
SELECT EMP_ID, EMP_NAME, DEPT_CODE, SALARY
FROM EMPLOYEE
WHERE SALARY > 3000000; -- 8명 조회됨
-- 두 쿼리의 중복되는 부분인 총 2명이 출력된다
```

- 교집합
- 여러 쿼리 결과의 중복된 결과만 추출한다
- EXISTS 또는 IN 서브쿼리를 이용한 SQL문으로 변경 가능하다

<br>

#### [ MINUS ]

```sql
SELECT EMP_ID, EMP_NAME, DEPT_CODE, SALARY
FROM EMPLOYEE
WHERE DEPT_CODE = 'D5' -- 6명 조회됨
MINUS
SELECT EMP_ID, EMP_NAME, DEPT_CODE, SALARY
FROM EMPLOYEE
WHERE SALARY > 3000000; -- 8명 조회됨
-- 선행쿼리문에서 후행쿼리문과 중복되는 부분인 2명을 뺀 4명이 출력된다
```

- 차집합
- 선행 쿼리문 결과값에서 후행 쿼리문 결과값을 뺀 나머지 부분을 추출한다  
  => 선행 쿼리문 결과값 - 교집합(1회)
- NOT EXISTS 또는 NOT IN 서브 쿼리를 이용한 SQL문으로 변경 가능하다

<br>

## JOIN

> ### JOIN이란

- 두개 이상의 테이블에서 데이터를 함께 조회하고자 할 때 사용되는 구문이다
- 수행결과는 하나의 결과물(Result Set)으로 나오게 된다
- 사용 목적
  - 관계형 데이터베이스에서는 중복의 최소화를 위해 최소한의 데이터로 각각의 테이블에 데이터를 보관하고 있다  
    => 즉 원하는 데이터 테이블을 새로 만들기보다 JOIN구문을 이용하여 각 테이블간의 관계를 맺고 함께 조회를 하는 것이다  
    => 단 무작정 JOIN을 하는 것이 아니라, 일반적으로 테이블의 식별값인 <u>Primary Key</u>와 테이블 간의 <u>연결고리(Foreign Key)</u>에 해당되는 칼럼을 매칭시켜서 조회해야 한다
- JOIN을 여러번 사용도 가능하다
- JOIN은 문법상 ORACLE 전용구문과 ANSI구문으로 나누어진다  
  => ANSI구문 : American National Standards Institute 미국 표준 협회에서 표준 SQL문을 정립해 놓은 것이다. 표준 SQL문이기 때문에 DBMS의 종류에 제약을 받지 않는다

| ORACLE 전용구문             | ANSI구문                                              |
| --------------------------- | ----------------------------------------------------- |
| 등가 조인(EQUAL JOIN)       | 내부조인(INNER JOIN) -> JOIN USING/ON                 |
| 포괄 조인                   | 외부 조인(OUTER JOIN) -> JOIN USING                   |
| (LEFT OUTER JOIN)           | 왼쪽 외부조인(LEFT OUTER JOIN)                        |
| (RIGHT OUTER JOIN)          | 오른쪽 외부조인(RIGHT OUTER JOIN)                     |
|                             | 전체 외부 조인(FULL OUTER JOIN) : 오라클에서 사용불가 |
| 카테시안곱                  | 교차조인(CROSS JOIN)                                  |
| 자체조인(SELF JOIN)         |                                                       |
| 비등가조인 (NON EQUAL JOIN) |                                                       |

<br>

#### [ EQUAL JOIN(등가) / INNER JOIN(내부) ]

- 연결시키고자 하는 칼럼 값들이 <u>일치하는 행들</u>만 JOIN해서 조회한다  
  => 일치하지 않는 값들은 결과에서 제외한다
- 가장 일반적으로 사용하는 '='에 의한 JOIN이다

<br>

##### ORACLE (등가조인)

- \[표현법]

  ```sql
  SELECT 조회하고자 하는 컬럼명들,
  FROM 조인하고자 하는 테이블명들
  WHERE 연결할 칼럼에 대한 조건을 제시 (=);
  ```

  - FROM절에 ',' 로 구분하여 합칠 테이블명들을 나열하고 WHERE절에서 합치기에 사용할 컬럼명을 명시 및 조건을 제시한다
  - WHERE절에서 FROM절에 사용한 테이블 별칭 이용이 가능하다
  - 테이블에서의 별칭은 AS를 쓰지 않고 공백으로만 구분시킨다
  - 일치하지 않는 값이거나 NULL인 값은 조회되지 않는다

- 예시)

  ```sql
  SELECT EMP_ID, EMP_NAME, DEPT_CODE, DEPT_TITLE
  FROM EMPLOYEE, DEPARTMENT
  WHERE DEPT_CODE = DEPT_ID;
  --EMPLOYEE 테이블의 DEPT_CODE 값과 DEPARTMENT테이블의 DEPT_ID가 일치하는 경우에만 조회된다
  ```

- 에러발생 예시)

  ```sql
  SELECT EMP_ID, EMP_NAME, JOB_CODE, JOB_NAME
  FROM EMPLOYEE , JOB
  WHERE JOB_CODE = JOB_CODE;
  -- 에러발생 : column ambiguously defined -> 칼럼명이 애매모호하다
  ```

  - 연결할 칼럼명이 일치(EMPLOYEE - JOB_CODE/ JOB - JOB_CODE)하는 경우 확실히 어느 테이블의 컬럼인지 제시해주어야 한다
  - 별칭 사용시 : `FROM EMPLOYEE E, JOB J ` 와 같이 테이블의 별칭을 붙이고 `WHERE E.JOB_CODE = J.JOB_CODE;` 와 같이 컬럼의 출처를 알려주게끔 작성하면 된다
  - 별칭 사용 없을 시 : `WHERE EMPLOYEE.JOB_CODE = JOB.JOB_CODE;` 와 같이 컬럼명 앞에 테이블명을 붙여주면 된다
  - 별칭을 부여하거나 테이블 명을 그대로 사용하거나 둘중 자유롭게 선택하면 되지만 둘을 혼합해서 사용할 수는 없으니 한쪽으로 통일시켜야 한다

<br>

##### ANSI (내부조인)

- 연결에 사용하려는 컬럼 명이 같은 경우 <u>USING구문</u>, 다른경우 <u>ON구문</u>을 사용한다
- 기본적으로 JOIN은 INNER JOIN이며 OUTER JOIN은 반드시 OUTER JOIN을 명시해야한다
- FROM 절에 기준이 되는 테이블을 <u>하나만</u> 기술한다
- 이후 JOIN 절에서 함께 조회하고자 하는 테이블과, 매칭시킬 컬럼에 대한 조건도 같이 기술한다

- ON 구문 표현법

  ```sql
  SELECT 조회할 컬럼명들 나열
  FROM 기준으로 삼을 테이블 1개만 제시
  JOIN 조인할 테이블 1개 제시 ON (연결할 칼럼에 대한 조건을 제시(=))
  ```

  - 연결할 컬럼 명이 다른 경우 무조건 ON구문만 사용 가능하다

- ON 구문 예시

  ```sql
  SELECT EMP_ID, EMP_NAME, DEPT_CODE, DEPT_TITLE
  FROM EMPLOYEE
  /*INNER*/ JOIN DEPARTMENT ON DEPT_CODE = DEPT_ID;
  -- INNER 는 생략 가능하다
  ```

- USING구문 표현법

  ```sql
  SELECT 조회하고자 하는 칼럼명들
  FROM 기준으로 삼을 테이블명 1개만 제시
  JOIN 조인할 테이블명 1개만 제시 USING (연결할 컬럼명 1개만 제시)
  ```

  - 컬럼명이 동일한 경우에만 사용가능하며 동일한 컬럼명 하나만 기술하면 알아서 매칭이 진행된다
  - USING을 사용한 구문에는 컬럼 별칭을 사용할 수 없다  
    => only simple column names allowed here 에러 발생

- USING구문 예시

  ```sql
  SELECT EMP_ID, EMP_NAME, JOB_CODE, JOB_NAME
  FROM EMPLOYEE
  JOIN JOB USING (JOB_CODE);
  -- EMPLOYEE의 JOB_CODE와 JOB의 JOB_CODE를 매칭시킨것임
  ```

<br>

#### [ EQUAL JOIN(등가) / INNER JOIN(내부) ]

<br>

##### ORACLE

```sql

```

<br>

##### ANSI

```sql

```
