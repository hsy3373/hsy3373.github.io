---
title: "[Oracle] SQL문법 13. PL/SQL"
excerpt: "INDEX 기본 문법"

categories:
  - Oracle
tags:
  - [Oracle, SQL, PL/SQL]

comments: true
toc: true
toc_sticky: true

date: 2023-01-04
last_modified_at: 2023-01-04
---

## PL/SQL (Procedural Language extension to SQL)

오라클 자체에 내장되어있으며 SQL을 확장한 절차적 언어이다  
오라클의 표준 데이터 엑세스 언어로, 프로시저 생성자를 SQL과 완벽하게 통합한다  
SQL문장 내에서 변수의 정의, 조건처리(IF), 반복문 처리(LOOP, FOR, WHILE), 예외처리 등을 지원하며 SQL문의 단점(앞에 해당하는 것들이 없음)을 보완한다  
다수의 SQL문을 한번에 실행 가능하다

<br>

> ### PL/SQL 특징

#### [ 기본 구조 ]

| 구조                              | 설명                                                                         |
| --------------------------------- | ---------------------------------------------------------------------------- |
| DECLARE SECTION<br>(선언부)       | `DECLARE`로 시작<br> 변수나 상수를 선언 및 초기화 하는 부분                  |
| EXECUTABLE SECTION<br>(실행부)    | `BEGIN`으로 시작<br>SQL문, 제어문, 반복문, 함수 정의 등 로직을 기술하는 부분 |
| EXCEPTION SECTION<br>(예외처리부) | `EXCEPTION`으로 시작<br>예외발생시 해결하기 위한 구문을 미리 기술하는 부분   |
| END                               | `END;`로 끝맺음<br>실행문을 종료하는 부분으로 이 뒤에 `/`까지 붙여주어야한다 |

- 선언부와 예외처리부는 생략이 가능하다

<br>

#### [ DECLARE 선언부 ]

```sql
[표현법]
DECLARE
  --변수/상수 선언 및 초기화(생략가능)
  변수명 [CONSTANT] 자료형 [NOT NULL] [:=값];
BEGIN
  실행부
END;
/

-- 예시
SET SERVEROUTPUT ON;
/*(프로시저를 사용하여 출력하는 내용을 화면에 보여주도록
    설정하는 환경변수로 기본값은 OFF여서 ON으로 변경해주어야 한다)*/

DECLARE
  EID NUMBER;
  ENAME VARCHAR2(20);
  PI CONSTANT NUMBER := 3.14;
BEGIN
  EID := &번호;
  ENAME := '&이름';
/* 사용자가 입력한 변수에서 바로 문자형으로 자동형변환이 되지 않기 때문에
  위와같이 ''로 감싸서 강제 형변환을 해준 것이다
  아예 사용자가 값을 입력할때 입력값에 ''를 포함해서 넣어주면 &이름 으로만 써도 무방하다 */
  DBMS_OUTPUT.PUT_LINE('EID : ' || EID);
  DBMS_OUTPUT.PUT_LINE('ENAME : ' || ENAME);
  DBMS_OUTPUT.PUT_LINE('PI : ' || PI);
END;
/
```

- DECLATE 선언부

  - 변수나 상수를 선언하는 공간이다
  - 변수/상수를 선언하는 동시에 초기화도 가능하다
  - 변수에는 일반타입, 레퍼런스, ROW타입 등이 있다
  - `CONSTANT`를 붙이면 상수가 되며 초기값을 반드시 할당해야한다
  - NOT NULL을 붙이면 해당 변수가 값을 반드시 포함하도록 한다
  - 값 초기화가 되어있지 않다면 그냥 빈값으로 출력된다(NULL값이 아닌 말그대로의 빈값)

- `:=` : 오라클식 대입 연산자이다

- `&이름`  
  => & 기호를 붙이면 사용자가 직접 값을 입력할 수 있는 입력창을 띄운다  
  => 이름 위치에 넣은 문자열이 입력창의 설명으로서 같이 뜨게 된다  
  => SELECT문 안에서 사용할 시엔 자동 형변환이 되어서 ''로 감싸줄 필요가 없지만 그 외에 문자열로서 값을 받아야 할 때엔 ''를 사용하여 강제 형변환을 해주어야 한다  
  => NUMBER 타입은 따로 형변환해줄 필요가 없다

- `||` : 연결 연산자로 문자열들을 더해서 하나의 문자열로 만들어준다

- `/` : 각각의 PL문은 /로 구분하기 때문에 END;로 마침표를 찍었더라도 꼭 /를 기입하여 구분해주어야 한다

- SERVEROUTPUT 옵션 : `DBMS_OUTPUT.PUT_LINE();` 으로 출력하는 내용을 화면에 보여주도록 하려면 해당 옵션을 켜주어야 한다

- 만약 0.3 등, 0으로 시작하는 숫자타입을 출력하게 되면 앞의 0이 사라지고 그냥 .3으로만 출력되게 된다  
  => 오라클에서는 정수값의 앞자리가 0이면 해당 0을 생략해버리니 주의

<br>

##### 레퍼런스 변수

```sql
DECLARE
  [표현법] 변수명 테이블명.컬럼명%TYPE;

  EID A_TABLE.ID_COLUMN%TYPE;
  ENAME A_TABLE.NAME_COLUMN%TYPE;
BEGIN
  SELECT ID_COLUMN, NAME_COLUMN
  INTO EID, ENAME
  FROM A_TABLE
  WHERE ID_COLUMN = &아이디;

  DBMS_OUTPUT.PUT_LINE('EID : ' || EID || ', ENAME : ' || ENAME);
END;
/
```

- 원하는 테이블 안, 특정 컬럼의 데이터타입을 참조해서 해당 타입으로 타입을 지정하게된다
- SELECT 구문으로 테이블의 컬럼들을 불러와서 INTO에 기입한 변수명에 해당 컬럼의 조회된 값을 차례대로 넣어주게 된다
- 일반적인 변수에는 하나의 값만을 넣을 수 있으므로 WHERE절 등을 사용해서 조회되는 컬럼의 값을 하나로 만들어주어야 에러가 나지 않는다
- SELECT 구문 안에서는 자동 형변환이 일어나기 때문에 `&`를 사용했더라도 따로 '' 처리를 해줄 필요가 없다

<br>

##### ROWTYPE 변수

```sql
DECLARE
  [표현법] 변수명 테이블명%ROWTYPE;

  T A_TABLE%ROWTYPE;
BEGIN
  SELECT * INTO T
  FROM A_TABLE
  WHERE ID_COLUMN = &아이디;

  -- [사용법] 변수명.컬럼명
  DBMS_OUTPUT.PUT_LINE(`ID_COLUMN : ` || T.ID_COLUMN);
  DBMS_OUTPUT.PUT_LINE(`NAME_COLUMN : ` || T.NAME_COLUMN);
  DBMS_OUTPUT.PUT_LINE(`ELSE_COLUMN : ` || T.ELSE_COLUMN);
END;
/
```

- 테이블의 한 행에 대한 모든 컬럼 값을 한꺼번에 담을 수 있는 변수이다
- `변수명.컬럼명` 식으로 원하는 컬럼의 값을 꺼내서 사용 가능하다
