---
title: "[Oracle] SQL문법 2.함수(Function)"
excerpt: "SQL의 함수들"

categories:
  - Oracle
tags:
  - [Oracle, SQL]

comments: true
toc: true
toc_sticky: true

date: 2020-12-15
last_modified_at: 2020-12-15
---

## 함수(Function)

하나의 큰 프로그램에서 반복적으로 사용되는 부분들을 분리하여 작성해놓은 작은 서브프로그램  
자바의 메서드와 같은 존재라고 볼 수 있다  
호출하며 값을 전달하면 결과를 리턴하는 방식으로 사용한다  
크게 아래 두가지로 나뉜다

- 단일행 함수 : n개의 값을 읽어서 n개의 결과를 리턴 (매 행마다 함수 실행 후 결과 반환)
- 그룹 함수 : n개의 값을 읽어서 1개의 결과를 리턴(하나의 그룹별로 함수 실행 후 결과 반환)

단일행 함수와 그룹함수는 결과 행의 갯수가 다르기 때문에 SELECT절에는 이 둘을 함께 사용할 수 없다

> ### 단일 행 함수

각 행마다 반복적으로 적용되어 입력받은 행의 개수만큼 결과를 반환하는 함수이다

#### [ 문자 처리 함수 ]

<table>
<thead>
  <tr>
    <th>구분</th>
    <th>입력 값</th>
    <th>리턴 값</th>
    <th>설명</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>LENGTH</td>
    <td rowspan="14">CHARACTER</td>
    <td rowspan="4">NUMBER</td>
    <td>문자열 길이 반환</td>
  </tr>
  <tr>
    <td>LENGTHB</td>
    <td>문자열의 바이트 크기 반환</td>
  </tr>
  <tr>
    <td>INSTR</td>
    <td>특정 문자의 위치 반환</td>
  </tr>
  <tr>
    <td>INSTRB</td>
    <td>특정 문자의 위치 바이트 크기 반환</td>
  </tr>
  <tr>
    <td>LPAD / RPAD</td>
    <td rowspan="10">CHARACTER</td>
    <td>지정 문자열을 입력한 크기만큼 본 문자열의 왼쪽 / 오른쪽부터 채워서 생성된 문자열 리턴</td>
  </tr>
  <tr>
    <td>LTRIM / RTRIM</td>
    <td>왼쪽 / 오른쪽부터 지정한 문자를 잘라내고 남은 문자 리턴</td>
  </tr>
  <tr>
    <td>TRIM</td>
    <td>왼쪽 / 오른쪽 / 양쪽부터 지정한 문자를 잘라내고 남은 문자 리턴</td>
  </tr>
  <tr>
    <td>SUBSTR</td>
    <td>지정한 위치에서 지정한 길이만큼 문자 잘라내어 리턴</td>
  </tr>
  <tr>
    <td>SUBSTRB</td>
    <td>지정한 위치에서 지정한 바이트만큼 문자를 잘라내어 리턴</td>
  </tr>
  <tr>
    <td>LOWER</td>
    <td>전달받은 문자 / 문자열을 소문자로 변환하여 리턴</td>
  </tr>
  <tr>
    <td>UPPER</td>
    <td>전달받은 문자 / 문자열을 대문자로 변환하여 리턴</td>
  </tr>
  <tr>
    <td>INITCAP</td>
    <td>전달받은 문자 / 문자열의 첫 글자만 대문자로, 나머지는 소문자로 변환하여 리턴</td>
  </tr>
  <tr>
    <td>CONCAT</td>
    <td>인자로 전달받은 두 개의 문자 / 문자열을 합쳐서 리턴</td>
  </tr>
  <tr>
    <td>REPLACE</td>
    <td>전달받은 문자열 중에서 지정한 문자를 인자로 전달받은 문자로 변환하여 리턴</td>
  </tr>
</tbody>
</table>

<br>

##### LENGTH : NUMBER

```sql
SELECT
    LENGTH('오라클 쉽네'), -- 6
    LENGTHB('오라클 야호') -- 11
FROM
    DUAL;
-- 가상 테이블(DUMMY TABLE) : 산술 연산이나 가상칼럼값등 한번만 출력하고 싶을 때 사용하는 테이블
```

- LENGTH() : 해당 전달된 문자열의 글자 수 반환
- LENGTHB () : 매개변수로 전달된 문자열의 바이트 수 반환
  - 한글 : 3byte
  - 영문, 숫자, 특수문자 : 1byte
  - 인코딩 설정에따라 모두 동일하게 2byte로 취급될수도 있다
- 표현법 : `LENGTH (CHAR | STRING)`
  - CHAR | STRING : 문자 타입 컬럼명 또는 문자열

<br>

##### INSTR : NUMBER

```sql
SELECT
  INSTR('AABAACAABBAA', 'B'), -- 3
  INSTR('AABAACAABBAA', 'B', - 1),  -- 10
  INSTR('AABAACAABBAA', 'B', - 1, 2),  -- 9
```

- 지정한 위치부터 지정한 숫자 번째로 나타나는 문자의 시작위치를 반환한다
- SQL은 숫자의 처음을 0 부터가 아닌 1부터 세는것을 감안하여 결과를 생각해야 한다
- POSITION이 -1 이라고 해서 맨 끝의 글자부터 1로 세는 것이 아님을 주의  
  => 찾을 문자를 끝에서 시작방향으로 하여 찾는것은 맞으나 반환하는 것은 첫글자부터 1로 차례대로 센 위치의 숫자 값이다
- 표현법 : `INSTR(STRING, STR, [POSITION,[OCCURRENCE]])`
  - = `INSTR(문자열, 특정 문자, 찾을 위치의 시작값, 순번)`
  - STRING : 문자 타입 컬럼 또는 문자열
  - STR : 찾으려는 문자열
  - POSITION : 찾을 위치 시작 값(기본 값 1 , -1)  
    => 1 : STRING의 시작부터 끝 방향으로 찾음
    => -1 : STRING의 끝부터 시작 방향으로 찾음
  - OCCURRENCE : 문자열 안에서 STR이 반복될 때 지정하는 위치(기본 값 1), 0 이하 사용 불가  
    => POSITION으로 정해진 찾는 방향을 기준으로 몇 번째 문자의 위치를 반환할 것인지를 나타낸다

<br>

##### LPAD / RPAD : CHARACTER

```sql
SELECT
  LPAD(EMAIL, 16),
  RPAD(EMAIL, 16)
```

- 주어진 컬럼/문자열에 임의의 문자열을 왼쪽/오른쪽에 덧붙여 최종 길이 N의 문자열을 반환한다
- 덧붙이고자 하는 문자를 따로 명시하지 않았다면 기본으로 공백이 덧붙여진다
- 중요한 정보들은 애초에 암호화되어 db에 들어오기 때문에 이러한 처리를 할 일이 거의 없다  
  => 사소한 정보들 가공에 조금씩 쓰이고 그다지 많이 사용되는 함수는 아님
- 표현법 : `LPAD(STRING, N, [STR]) / RPAD(STRING, N, [STR])`
  - = `LPAD /RPAD (문자열, 최종적으로 반환할 문자의 길이 (BYTE), 덧붙이고자 하는 문자)`
  - STRING : 문자 타입 컬럼 또는 문자열
  - N : 반환할 문자(열)의 길이(바이트), 원래 STRING의 길이보다 작다면 N만큼 잘라서 표시
  - STR : 덧붙이려는 문자(열), 생략 시 공백문자

<br>

##### LTRIM / RTRIM : CHARACTER

```sql
SELECT
    LTRIM('    D   D   D     '),        -- 'D   D   D  '
    RTRIM('0001230456000855000', '0'),  -- '0001230456000855'
    LTRIM('11332212312KH123123', '123') -- 'KH123123'
```

- 주어진 컬럼/문자열의 왼쪽/오른쪽에서 지정한 STR에 포함된 모든 문자를 제거한 나머지를 반환한다
- 제거하고자 하는 문자를 명시하지 않으면 기본으로 공백을 제거한다
- 제거하고자 하는 문자열을 명시 했을 때 그 문자열을 통으로 지워주는 것이 아니다  
  => 문자 하나하나 검사를 하면서 현재 문자가 지우고자하는 문자열 안에 포함되어있다면 지워준다
- 표현법 : `LTRIM(STRING, STR) / RTRIM(STRING, STR)`
  - = `LTRIM / RTRIM (문자열, 제거시키고자 하는 문자)`
  - STRING : 문자 타입 컬럼 또는 문자열
  - STR : 제거하려는 문자(열), 생략 시 공백문자

<br>

##### TRIM : CHARACTER

```sql
SELECT
    TRIM('       F     F         '),         -- 'F     F'
    TRIM('Z' FROM 'ZZZZZZFFZZZZZZ'),         -- 'FF'
    TRIM(LEADING 'Z' FROM 'ZZZZZZFFZZZZZZ'), -- 'FFZZZZZZ'
```

- 주어진 컬럼/문자열의 앞/뒤/양쪽에 있는 지정한 문자를 제거한 나머지를 반환한다
- 지정 문자는 한 하나의 문자만 가능하다
- 표현법 : `TRIM( LEADING | TRAILING | BOTH [CHAR] FROM STRING)`
  - = `TRIM(BOTH | LEADING | TRAILING  '제거하고자 하는 문자' FROM '문자열')`
  - STRING : 문자 타입 컬럼 또는 문자열
  - CHAR : 제거하려는 문자(열), 생략 시 공백문자
  - LEADING : TRIM할 CHAR의 위치 지정, 앞(LEADING) / 뒤(TRAILING) / 양쪽(BOTH) 지정 가능(기본 값 양쪽)

<br>

##### SUBSTR : CHARACTER

```sql
SELECT
    SUBSTR('ORACLEDATABASE', 7),     -- 'DATABASE'
    SUBSTR('ORACLEDATABASE', 7, 4),  -- 'DATA'
    SUBSTR('ORACLEDATABASE', - 8, 3) -- 'DAT'
```

- 컬럼/문자열에서 지정한 위치부터 지정한 개수의 문자열을 잘라내어 반환한다
- 추출할 문자 갯수를 명시하지 않으면 해당 문자열 끝까지 출력된다
- 처음위치는 음수로도 제시 가능하다  
  => 뒤에서부터 N번째 위치로부터 문자를 추출함
- 표현법 : `SUBSTR( STRING, POSITION, [LENGTH] )`
  - = `SUBSTR (문자열, 처음위치, 추출할 문자갯수)`
  - STRING : 문자 타입 컬럼 또는 문자열
  - POSITION : 문자열을 잘라낼 위치로 양수면 시작방향에서 지정한 수만큼, 음수면 끝 방향에서 지정한 수만큼의 위치 의미
  - LENGTH : 반환할 문자 개수(생략 시 문자열의 끝까지 의미, 음수면 NULL 리턴)

<br>

##### LOWER / UPPER / INITCAP : CHARACTER

```sql
SELECT
    LOWER('WELCOME TO C CLASS'), -- 'welcome to c class'
    UPPER('wellcom to c class'), -- 'WELLCOM TO C CLASS'
    INITCAP('welcom to c class') -- 'Welcom To C Class'
```

- 컬럼/문자열을 소문자/대문자/첫 글자만 대문자로 변환하여 반환한다
- LOWER(문자열) : 소문자로 변경
- UPPER(문자열) : 대문자로 변경
- INITCAP(문자열) : 각 <u>단어</u>의 첫글자만 대문자로 변환
- 표현법 : `LOWER(STRING) / UPPER(STRING) / INITCAP(STRING)`
  - STRING : 문자 타입 컬럼 또는 문자열

<br>

##### CONCAT : CHARACTER

```sql
SELECT
    CONCAT('가나다', '라마바사') -- '가나다라마바사'
```

- 컬럼/문자열을 두개 전달받아 하나로 합친 후 반환한다
- 매개 문자열은 두개까지밖에 입력하지 못한다
- `||` 연결 연산자와 동일한 역할이라고 할 수 있다
- 표현법 : `CONCAT(STRING, STRING)`

<br>

##### REPLACE : CHARACTER

```sql
SELECT REPLACE('서울시 강남구 역삼동 56번길 강남빌딩 3층', '3층', '2층 C 클래스')
    -- 서울시 강남구 역삼동 56번길 강남빌딩 2층 C 클래스
```

- 컬럼/문자열에서 특정문자(열)을 지정한 문자(열)로 바꾼 후 반환한다
- 표현법 : `REPLACE(STRING, STR1, STR2)`
  - = `REPLACE (문자열, 찾을문자, 바꿀문자)`
  - STRING : 문자 타입 컬럼 또는 문자열
  - STR1 : 변경하려고 하는 문자 혹은 문자열
  - STR2 : 변경하고자 하는 문자 혹은 문자열

<br>

#### [ 숫자 처리 함수 ]

<table>
<thead>
  <tr>
    <th>구분</th>
    <th>입력 값</th>
    <th>리턴 값</th>
    <th>설명</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>ABS</td>
    <td rowspan="6">NUMBER</td>
    <td rowspan="6">NUMBER</td>
    <td>절대 값 리턴</td>
  </tr>
  <tr>
    <td>MOD</td>
    <td>입력 받은 수를 나눈 나머지 값 반환</td>
  </tr>
  <tr>
    <td>ROUND</td>
    <td>특정 자릿수에서 반올림</td>
  </tr>
  <tr>
    <td>FLOOR</td>
    <td>버림(소수점 아래를 잘라냄)</td>
  </tr>
  <tr>
    <td>TRUNC</td>
    <td>특정 자릿수에서 잘라냄</td>
  </tr>
  <tr>
    <td>CEIL</td>
    <td>올림(소수점 아래에서 올림)</td>
  </tr>
</tbody>
</table>

<br>

#### [ 날짜 처리 함수 ]

<table>
<thead>
  <tr>
    <th>구분</th>
    <th>입력 값</th>
    <th>리턴 값</th>
    <th>설명</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>SYSDATE</td>
    <td rowspan="2">DATE</td>
    <td>DATE</td>
    <td>시스템에 저장된 현재 날짜 반환</td>
  </tr>
  <tr>
    <td>MONTHS_BETWEEN</td>
    <td>NUMBER</td>
    <td>두 날짜를 전달받아 몇 개월 차이인지 계산하여 반환</td>
  </tr>
  <tr>
    <td>ADD_MONTHS</td>
    <td rowspan="4">DATE</td>
    <td rowspan="4">DATE</td>
    <td>특정 날짜에 개월 수를 더하여 반환</td>
  </tr>
  <tr>
    <td>NEXT_DAY</td>
    <td>특정 날짜에서 인자로 받은 요일이 최초로 다가오는 날짜 반환</td>
  </tr>
  <tr>
    <td>LAST_DAY</td>
    <td>해당 달의 마지막 날짜 반환</td>
  </tr>
  <tr>
    <td>EXTRACT</td>
    <td>년, 월, 일 정보를 추출하여 반환</td>
  </tr>
</tbody>
</table>

<br>

#### [ 형 변환 함수 ]

| 구분      | 입력 값            | 리턴 값   | 설명                                 |
| --------- | ------------------ | --------- | ------------------------------------ |
| TO_CHAR   | DATE / NUMBER      | CHARACTER | 날짜형 혹은 숫자형을 문자형으로 변환 |
| TO_DATE   | CHARACTER / NUMBER | DATE      | 문자형 혹은 숫자형을 날짜형으로 변환 |
| TO_NUMBER | CHARACTER          | NUMBER    | 문자형을 숫자형으로 변환             |

<br>

#### [ NULL 처리 함수 ]

- NVL

<br>

#### [ 선택 함수 ]

- DECODE
- CASE

<br>

> ### 그룹 함수

| 구분  | 설명                  |
| ----- | --------------------- |
| SUM   | 그룹의 누적 합계 반환 |
| AVG   | 그룹의 평균 반환      |
| COUNT | 그룹의 총 개수 반환   |
| MAX   | 그룹의 최대 값 반환   |
| MIN   | 그룹의 최소 값 반환   |

<br>

> ### GROUP BY
